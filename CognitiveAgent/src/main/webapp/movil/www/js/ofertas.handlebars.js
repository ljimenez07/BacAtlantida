(function() {
  var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};
templates['ofertas'] = template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    return "<div class=\"row\">\n	<div class=\"col-xs-12 contenedor-de-mensaje-bienvenida\">\n		<p><strong>¡Hola!</strong></p><br>\n		<p>¿Sab&iacute;as que si inicias sesi&oacute;n puedes tener acceso a <strong>m&uacute;ltiples beneficios</strong> que tenemos disponibles especialmente para ti?</p>\n		<br>\n	</div>\n</div>\n\n<div class=\"contenedor-de-ofertas\">\n</div>\n<div id=\"contenedor-mostrar-mas\" style=\"display: none\">\n	<br>\n	<div class=\"row\">\n		<div class=\"col-xs-12 text-center\">\n			<span id=\"mostrar-mas\">Mostrar más</span>\n		</div>\n	</div>\n</div>\n\n<script type=\"text/javascript\">\nvar pagina = 1;\n\nfunction evaluarVerMas()\n{\n	ajax({\n		url: serverDomain + \"/ofertas/cantidad\",\n		done: function(data)\n		{\n			cargarOfertas();\n			var cantidadDeOfertasMostradas = pagina * 10;\n			if(data.cantidad > cantidadDeOfertasMostradas)\n			{\n				$(\"#contenedor-mostrar-mas\").show();\n			}\n			else\n			{\n				$(\"#contenedor-mostrar-mas\").remove();\n			}\n		}\n	});\n}\n\nevaluarVerMas();\n\n$(\"#mostrar-mas\").on(\"click\", function()\n{\n	evaluarVerMas();\n	pagina++;\n});\n\nfunction bindAcciones()\n{\n	$(\"#ofertas .datos-de-oferta\").off(\"click\").on(\"click\", function()\n	{\n		$(\"#oferta .panel-body\").html(\"\");\n		cambiarVista(\"oferta\", true);\n		var id = $(this).attr(\"id\");\n		ajax({\n			url: serverDomain + \"/ofertas/\" + id,\n			done: function(data)\n			{\n				$(\"#oferta .panel-body\").html(Handlebars.templates.oferta(data));\n	\n				$(\"#oferta .boton-escuchar-oferta\").off(\"click\").on(\"click\", function()\n				{\n					agregarCarga();\n					agregarAColaDeReproduccion($(this).data(\"audio\"));\n				});\n	\n				$(\"#oferta .boton-compartir\").off(\"click\").on(\"click\", function()\n				{\n					setTimeout(compartir($(this).data(\"id\"), $(this).data(\"path\"), $(this).data(\"titulo\")), 0);\n				});\n				\n				$(\"#oferta .imagen-de-oferta\").each(function()\n				{\n					var path = serverDomain + $(this).attr(\"src\");\n					$(this).attr(\"src\", path);\n				});\n	 		}\n		});\n	});\n	\n	$(\"#ofertas .boton-like, #ofertas .boton-dislike\").off(\"click\").on(\"click\", function()\n	{\n		var parent = $(this).parent().parent();\n		var idDeLaOferta = $(this).data(\"id\");\n		var activo = parent.find(\".estado-1\");\n		if(activo.attr('class') != $(this).attr('class')) {\n			activo.addClass(\"estado-0\").removeClass(\"estado-1\");\n		}\n		$(this).toggleClass(\"estado-1\").toggleClass(\"estado-0\");\n		var esLike = parent.find(\".boton-like\").hasClass(\"estado-1\");\n		var esDislike = parent.find(\".boton-dislike\").hasClass(\"estado-1\");\n		var reaccion = null;\n		if(esLike)\n		{\n			reaccion = true;\n		}\n		else if(esDislike)\n		{\n			reaccion = false;\n		}\n		ajax({\n			type: \"POST\",\n			url: serverDomain + \"/reaccion/oferta\",\n			data:\n			{\n				idOferta: idDeLaOferta,\n				reaccion: reaccion\n			}\n		});\n	});\n	\n	$(\"#ofertas .boton-escuchar\").off(\"click\").on(\"click\", function()\n	{\n		agregarCarga();\n		if(deviceType != \"iPad\" && deviceType != \"iPhone\")\n		{\n			agregarAColaDeReproduccion($(this).data(\"audio\"));\n		}\n		else\n		{\n			var audio = new Audio();\n			audio.src = serverDomain + $(this).data(\"audio\");\n			audio.onplay = quitarCarga;\n			audio.play();\n		}\n	});\n	\n	$(\"#ofertas .boton-compartir\").off(\"click\").on(\"click\", function()\n	{\n		setTimeout(compartir($(this).data(\"id\"), $(this).data(\"path\"), $(this).data(\"titulo\")), 0);\n	});\n}\n\nfunction compartir(id, pathImagen, titulo)\n{\n	agregarCarga();\n	var options = {\n		message: titulo, // not supported on some apps (Facebook, Instagram)\n		subject: titulo, // fi. for email\n		files: [serverDomain + \"/archivossubidos/\" + pathImagen], // an array of filenames either locally or remotely\n		url: serverDomain + \"/ofertas/compartida/\" + id,\n		chooserTitle: 'Seleccione una aplicación' // Android only, you can override the default share sheet title\n	}\n	\n	var onSuccess = function(result)\n	{\n		quitarCarga();\n		console.log(\"Share completed? \" + result.completed); // On Android apps mostly return false even while it's true\n		console.log(\"Shared to app: \" + result.app); // On Android result.app is currently empty. On iOS it's empty when sharing is cancelled (result.completed=false)\n	}\n	\n	var onError = function(msg)\n	{\n		quitarCarga();\n		console.log(\"Sharing failed with message: \" + msg);\n	}\n	\n	window.plugins.socialsharing.shareWithOptions(options, onSuccess, onError);\n}\n\nfunction agregarDominioAImagenes()\n{\n	$(\"#ofertas .imagen-de-oferta\").each(function()\n	{\n		var source = $(this).attr(\"src\");\n		var noTieneDominio = source.indexOf(serverDomain) < 0;\n		if(noTieneDominio)\n		{\n			var path = serverDomain + source;\n			$(this).attr(\"src\", path);\n		}\n	});\n}\n\nfunction cargarOfertas()\n{\n	ajax({\n		url: serverDomain + \"/ofertas\",\n		data:\n		{\n			pagina: pagina\n		},\n		done: function(data)\n		{\n			console.log(data.resultados.length);\n			$(\"#ofertas .contenedor-de-ofertas\").append(Handlebars.templates.listaDeOfertas({ofertas: data.resultados}));\n			bindAcciones();\n			bindClickeable();\n			agregarDominioAImagenes();\n			pagina = data.indice.pagina;\n		}\n	});\n}\n</script>\n";
},"useData":true});
})();